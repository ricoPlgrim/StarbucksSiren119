<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0; maximum-scale=1.0; minimum-scale=1.0; user-scalable=no;" />
    <meta name="virtual-keyboard" content="overlays-content">
    <title>Fixed Element with Input</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            overflow-x: hidden;
        }

        .content {
            height: 200vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .fixed-element {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #fff;
            z-index: 1000;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
            padding: 10px;
        }

        input {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="content">
        <p>Scroll down to see the fixed element at the bottom.</p>
        <p>Tap the input field to see the effect when the keyboard appears.</p>
    </div>
    <div class="fixed-element">
        <input type="text" placeholder="Focus on me">
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            const $body = $('body');
            const $fixedElement = $('.fixed-element');
            let isKeyboardVisible = false;

            function updateViewportHeight() {
                const viewportHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;
                if (isKeyboardVisible) {
                    $body.css('height', `${viewportHeight}px`);
                    $fixedElement.css('bottom', `${window.visualViewport ? window.visualViewport.height - window.innerHeight : 0}px`);
                } else {
                    $body.css('height', 'auto');
                    $fixedElement.css('bottom', '0');
                }
            }

            function handleScroll() {
                if (isKeyboardVisible) {
                    let viewportTopGap = window.visualViewport.pageTop - window.visualViewport.offsetTop;
                    let translateY = window.scrollY - viewportTopGap;
                    $fixedElement.css('transform', `translateY(${translateY}px)`);
                }
            }

            $(window).on('resize', function() {
                const windowInnerHeight = window.innerHeight;
                const viewportHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;
                isKeyboardVisible = windowInnerHeight > viewportHeight;
                updateViewportHeight();
            });

            $(document).on('focusin', 'input, textarea', function() {
                isKeyboardVisible = true;
                updateViewportHeight();
            });

            $(document).on('focusout', 'input, textarea', function() {
                isKeyboardVisible = false;
                updateViewportHeight();
            });

            $(window).on('scroll', handleScroll);
            if (window.visualViewport) {
                window.visualViewport.addEventListener('scroll', handleScroll);
            }

            // 초기 로드 시 높이 설정
            const windowInnerHeight = window.innerHeight;
            const viewportHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;
            isKeyboardVisible = windowInnerHeight > viewportHeight;
            updateViewportHeight();
        });
    </script>
</body>
</html>